{% extends "base.html" %}
{# title is set in the route #}

{% block head_extra %}
<style>
    :root { /* Consistent styles */
        --kb-primary-color: #007bff; --kb-light-gray: #f8f9fa; --kb-medium-gray: #e9ecef;
        --kb-dark-gray: #6c757d; --kb-text-dark: #343a40; --kb-card-border: #dee2e6;
        --kb-radius: 0.3rem;
    }
    .kb-article-page { padding-top: 1rem; }
    .kb-breadcrumbs { list-style: none; padding: 0; margin-bottom: 1rem; font-size: 0.9rem; }
    .kb-breadcrumbs li { display: inline; }
    .kb-breadcrumbs li+li:before { content: "/\\00a0"; padding: 0 0.5em; color: var(--kb-dark-gray); }
    .kb-breadcrumbs a { color: var(--kb-primary-color); text-decoration: none; }
    .kb-breadcrumbs a:hover { text-decoration: underline; }
    .kb-breadcrumbs .current-page { color: var(--kb-text-dark); font-weight: 500; }

    .kb-article-header h1 { font-size: 2rem; font-weight: 600; color: var(--kb-text-dark); margin-bottom: 0.5rem; }
    .kb-article-meta-bar { font-size: 0.85rem; color: var(--kb-dark-gray); margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--kb-medium-gray); }
    .kb-article-meta-bar i { margin-right: 0.3em; }
    .kb-article-meta-bar span+span::before { content: "|"; margin: 0 0.75em; opacity:0.5; }

    .kb-article-content { line-height: 1.7; color: var(--kb-text-dark); font-size: 1.05rem; }
    .kb-article-content h2 { font-size: 1.6rem; margin-top: 2rem; margin-bottom: 0.75rem; padding-bottom: 0.25rem; border-bottom: 1px solid var(--kb-medium-gray); font-weight: 600; }
    .kb-article-content h3 { font-size: 1.4rem; margin-top: 1.5rem; margin-bottom: 0.5rem; font-weight: 600; }
    .kb-article-content p { margin-bottom: 1rem; }
    .kb-article-content ul, .kb-article-content ol { margin-bottom: 1rem; padding-left: 1.5rem; }
    .kb-article-content li { margin-bottom: 0.3rem; }
    .kb-article-content blockquote { border-left: 4px solid var(--kb-primary-color); padding: 0.5rem 1rem; margin: 1rem 0; background-color: var(--kb-light-gray); color: #555; font-style: italic; }
    .kb-article-content pre { background-color: #2d2d2d; color: #f8f8f2; padding: 1em; border-radius: var(--kb-radius); overflow-x: auto; font-family: monospace; font-size: 0.9em; }
    .kb-article-content code { background-color: var(--kb-medium-gray); padding: 0.2em 0.4em; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
    .kb-article-content pre code { background-color: transparent; padding: 0; }
    .kb-article-content table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
    .kb-article-content th, .kb-article-content td { border: 1px solid var(--kb-card-border); padding: 0.5rem 0.75rem; text-align: left; }
    .kb-article-content th { background-color: var(--kb-light-gray); font-weight: 600; }
    .kb-article-content img { max-width: 100%; height: auto; border-radius: var(--kb-radius); margin: 0.5rem 0; }

    .kb-article-tags { margin-top: 2rem; }
    .kb-tag { display: inline-block; background-color: var(--kb-medium-gray); color: var(--kb-text-dark); padding: 0.25rem 0.75rem; margin-right: 0.5rem; margin-bottom: 0.5rem; border-radius: 15px; font-size: 0.8rem; text-decoration:none; }
    .kb-tag:hover { background-color: var(--kb-dark-gray); color:white; }
    
    /* Styles for Table of Contents if generated by Markdown extension */
    .toc ul { list-style-type: none; padding-left: 0; }
    .toc > ul > li { margin-bottom: 0.5em; }
    .toc > ul > li > a { font-weight: 500; }
    .toc ul ul { padding-left: 1.5em; margin-top: 0.25em; }
    .toc ul ul li a { font-weight: normal; font-size: 0.95em; }

</style>
{% endblock %}

{% block content %}
<div class="container mt-4 kb-article-page">
    <nav aria-label="breadcrumb">
        <ol class="kb-breadcrumbs">
            <li><a href="{{ url_for('kb_category_view') }}">Knowledge Base</a></li>
            {% for crumb in breadcrumbs %}
                <li><a href="{{ url_for('kb_category_view', slug=crumb.slug) }}">{{ crumb.name }}</a></li>
            {% endfor %}
            <li class="current-page">{{ article.title|truncate(50,true) }}</li>
        </ol>
    </nav>

    <article>
        <header class="kb-article-header">
            <h1>{{ article.title }}</h1>
            <div class="kb-article-meta-bar">
                <span><i class="fas fa-folder-open"></i> Category: <a href="{{ url_for('kb_category_view', slug=article.kb_category_ref.slug) }}">{{ article.kb_category_ref.name }}</a></span>
                {% if article.author %}<span><i class="fas fa-user"></i> Author: {{ article.author.username }}</span>{% endif %}
                <span><i class="fas fa-clock"></i> Last Updated: {{ article.updated_at.strftime('%B %d, %Y') }}</span>
                <span><i class="fas fa-eye"></i> Views: {{ article.views }}</span>
            </div>
        </header>

        <section class="kb-article-content">
            {{ html_content|safe }}
        </section>

        {% if article.tags %}
        <footer class="kb-article-tags">
            <strong><i class="fas fa-tags"></i> Tags:</strong>
            {% for tag in article.tags.split(',') %}
                <a href="{{ url_for('kb_category_view', q=tag.strip()) }}" class="kb-tag">{{ tag.strip() }}</a>
            {% endfor %}
        </footer>
        {% endif %}
    </article>
</div>
{% endblock %}